import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px
import plotly.graph_objects as go
import folium
from streamlit_folium import st_folium

# ----------------------------
# í˜ì´ì§€ ì„¤ì •
# ----------------------------
st.set_page_config(
    page_title="ë©ˆì¶”ì§€ ì•ŠëŠ” ì—ì–´ì»¨ê³¼ í•´ìˆ˜ë©´ ìƒìŠ¹",
    layout="wide"
)

# ----------------------------
# ì œëª© & ì„œë¡ 
# ----------------------------
st.title("â„ï¸ ë©ˆì¶”ì§€ ì•ŠëŠ” ì—ì–´ì»¨ê³¼ í•´ìˆ˜ë©´ ìƒìŠ¹")
st.subheader("ê³¼ë„í•œ ëƒ‰ë°© ì‚¬ìš©ì´ ë¶ˆëŸ¬ì˜¨ ì§€êµ¬ì˜ ëœ¨ê±°ìš´ ëŒ€ê°€")

st.markdown("""
ì—¬ë¦„ì´ ë˜ë©´ ìš°ë¦¬ëŠ” ë”ìœ„ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ë¬´ì‹¬ì½” ì—ì–´ì»¨ì„ ì¼ ë‹¤.  
ì‹œì›í•¨ì€ ë‹¹ì¥ ì†ì— ì¡íˆì§€ë§Œ, ê·¸ ì´ë©´ì—ì„œ ë³´ì´ì§€ ì•ŠëŠ” ëŒ€ê°€ëŠ” ì§€êµ¬ê°€ ì¹˜ë¥´ê³  ìˆë‹¤.  

ì—ì–´ì»¨ì€ ë‹¨ìˆœí•œ ê°€ì „ì œí’ˆì´ ì•„ë‹ˆë¼ **ì˜¨ì‹¤ê°€ìŠ¤ ë°°ì¶œì˜ ì£¼ìš” ì›ì¸ ì¤‘ í•˜ë‚˜**ì´ë‹¤.  
ì „ê¸°ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ í™”ì„ì—°ë£Œê°€ ëŒ€ëŸ‰ìœ¼ë¡œ ì†Œë¹„ë˜ê³ , ì´ì‚°í™”íƒ„ì†ŒëŠ” ëŒ€ê¸° ì¤‘ì— ìŒ“ì—¬ ì§€êµ¬ì˜ ì˜¨ë„ë¥¼ ë†’ì¸ë‹¤.  
ê·¸ ê²°ê³¼ ë°”ë‹·ë¬¼ì€ ì—´ì„ ë¨¸ê¸ˆì–´ íŒ½ì°½í•˜ê³ , ë¹™í•˜ê°€ ë…¹ì•„ë‚´ë¦¬ë©° **í•´ìˆ˜ë©´ì€ ì ì  ìƒìŠ¹**í•œë‹¤.  

ì´ ë³€í™”ëŠ” ë‹¨ìˆœíˆ ê³¼í•™ì  ìˆ˜ì¹˜ì— ë¨¸ë¬´ë¥´ì§€ ì•ŠëŠ”ë‹¤.  
ìš°ë¦¬ê°€ ë°©í•™ ë•Œ ì°¾ëŠ” í•´ìˆ˜ìš•ì¥, ì„¸ê³„ì˜ ìœ ëª… ê´€ê´‘ì§€, ê·¸ë¦¬ê³  ë¯¸ë˜ì— ì‚´ ì§‘ê³¼ í•™êµê¹Œì§€ë„ ìœ„í˜‘ë°›ê³  ìˆë‹¤.  
ì¦‰, ì˜¤ëŠ˜ì˜ ì‘ì€ ëƒ‰ë°© ìŠµê´€ì´ ë‚´ì¼ì˜ ì‚¶ì˜ í„°ì „ì„ ë°”ê¾¸ê³  ìˆëŠ” ê²ƒì´ë‹¤.  

ë”°ë¼ì„œ ìš°ë¦¬ëŠ” **ì—ì–´ì»¨ ì‚¬ìš©ê³¼ í•´ìˆ˜ë©´ ìƒìŠ¹ì˜ ì—°ê´€ì„±ì„ ë°ì´í„°ë¡œ ì§ì ‘ í™•ì¸**í•˜ê³ ,  
**ì²­ì†Œë…„ìœ¼ë¡œì„œ ì§€ê¸ˆ ë‹¹ì¥ ì‹¤ì²œí•  ìˆ˜ ìˆëŠ” ë°©ë²•**ì„ ì°¾ì•„ì•¼ í•œë‹¤.  
ì´ íƒêµ¬ëŠ” ë‹¨ìˆœí•œ ê³µë¶€ê°€ ì•„ë‹ˆë¼, ìš°ë¦¬ì˜ ë¯¸ë˜ë¥¼ ì§€í‚¤ëŠ” í–‰ë™ ì§€ì¹¨ì´ ë  ê²ƒì´ë‹¤.
""")

# ----------------------------
# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
# ----------------------------
@st.cache_data
def load_sea_level_data():
    url = "https://raw.githubusercontent.com/datasets/sea-level-rise/master/data/epa-sea-level.csv"
    df = pd.read_csv(url)
    df = df.rename(columns={"Year": "year", "CSIRO Adjusted Sea Level": "sea_level"})
    df = df.dropna(subset=["sea_level"])
    return df

sea_df = load_sea_level_data()

# ----------------------------
# ê³µí†µ ë³´ê³ ì„œ + ì²´í¬ë¦¬ìŠ¤íŠ¸
# ----------------------------
def report_and_checklist(tab_name):
    st.markdown("""
    ## ë³¸ë¡  1  
    ì „ë ¥ ì†Œë¹„ëŠ” ë‹¨ìˆœí•œ ìˆ«ìê°€ ì•„ë‹ˆë¼ ë°”ë‹¤ì™€ ì§ê²°ëœë‹¤. ì—ì–´ì»¨ì„ ì˜¤ë˜ ì¼¤ìˆ˜ë¡ ë°œì „ì†ŒëŠ” ë” ë§ì€ í™”ì„ì—°ë£Œë¥¼ íƒœìš°ê³ , ì´ ê³¼ì •ì—ì„œ ë‚˜ì˜¨ ì´ì‚°í™”íƒ„ì†ŒëŠ” ì§€êµ¬ì˜ ì˜¨ë„ë¥¼ ëŒì–´ì˜¬ë¦°ë‹¤.  
    ì˜¨ë„ê°€ ì˜¤ë¥´ë©´ í•´ìˆ˜ëŠ” íŒ½ì°½í•˜ê³ , ê·¹ì§€ë°© ë¹™í•˜ëŠ” ë…¹ì•„ ë°”ë‹¤ ìˆ˜ìœ„ëŠ” ì ì  ë†’ì•„ì§„ë‹¤.  
    ì¦‰, ìš°ë¦¬ê°€ ë°© ì•ˆì—ì„œ ë²„íŠ¼ í•˜ë‚˜ë¡œ ì‹œì›í•¨ì„ íƒí•  ë•Œë§ˆë‹¤, ë°”ë‹·ê°€ëŠ” í•œ ê±¸ìŒì”© ìš°ë¦¬ ë•…ì„ í–¥í•´ ë‹¤ê°€ì˜¤ê³  ìˆëŠ” ê²ƒì´ë‹¤.  

    ## ë³¸ë¡  2  
    ì‹¤ì œ ë°ì´í„°ëŠ” ì´ë¥¼ ë’·ë°›ì¹¨í•œë‹¤. 1993ë…„ë¶€í„° ê¾¸ì¤€íˆ ìƒìŠ¹í•´ ì˜¨ í•´ìˆ˜ë©´ì€ ì´ë¯¸ ìˆ˜ì‹­ mmë‚˜ ì˜¬ëë‹¤.  
    ë„ì‹œë³„ ì§€ë„ë¥¼ ë³´ë©´ ì„¸ê³„ì˜ ì£¼ìš” ê´€ê´‘ì§€ê°€ ì ê¸¸ ìœ„ê¸°ì— ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.  
    ë‰´ìš•ì˜ ììœ ì˜ ì—¬ì‹ ìƒ, ë„ì¿„ ë””ì¦ˆë‹ˆëœë“œ, ë¶€ì‚° í•´ìš´ëŒ€ í•´ìˆ˜ìš•ì¥ ë“±, ìš°ë¦¬ê°€ ê¿ˆê¾¸ë˜ ì—¬í–‰ì§€ê°€ ë°”ë‹·ë¬¼ì— ì ê¸¸ ìˆ˜ ìˆë‹¤.  
    ë˜í•œ ì—ì–´ì»¨ ì‹œë®¬ë ˆì´í„°ì—ì„œ í™•ì¸í–ˆë“¯, ì¼ìƒ ì† ì‘ì€ ì‚¬ìš©ë„ ëˆ„ì ë˜ë©´ í° ë°°ì¶œë¡œ ì´ì–´ì§„ë‹¤.  

    ## ê²°ë¡  ë° ì œì–¸  
    ë°”ë‹¤ì˜ ì˜¨ë„ê°€ ì˜¤ë¥´ë©´ êµì‹¤ë„ ë“ëŠ”ë‹¤. í•´ìˆ˜ë©´ì´ ì˜¤ë¥´ë©´ ìš°ë¦¬ì˜ ë¯¸ë˜ ê³µê°„ì€ ì¤„ì–´ë“ ë‹¤.  
    í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì´ ë³€í™”ë¥¼ ë§‰ì„ ë§ˆì§€ë§‰ ì„¸ëŒ€ì¼ ìˆ˜ë„ ìˆë‹¤.  
    ë”°ë¼ì„œ ì§€ê¸ˆ ë‹¹ì¥ì˜ ì‘ì€ ì‹¤ì²œì´ ë¬´ì—‡ë³´ë‹¤ ì¤‘ìš”í•˜ë‹¤. ì—ë„ˆì§€ ì ˆì•½ê³¼ íƒ„ì†Œ ë°°ì¶œ ê°ì¶•ì€ ë¨¼ ë¯¸ë˜ì˜ ì´ì•¼ê¸°ê°€ ì•„ë‹ˆë¼, ì˜¤ëŠ˜ ìš°ë¦¬ ì†ì— ë‹¬ë ¤ ìˆë‹¤.  

    ìš°ë¦¬ê°€ ì‹¤ì²œí•  ìˆ˜ ìˆëŠ” ë°©ì•ˆìœ¼ë¡œëŠ” ì—¬ë¦„ì²  ì—ì–´ì»¨ ì˜¨ë„ë¥¼ 26ë„ë¡œ ìœ ì§€í•˜ê³ , ì„ í’ê¸°ì™€ ë³‘í–‰í•˜ì—¬ ì‚¬ìš©í•˜ë©°, ëŒ€ì¤‘êµí†µì„ ë” ìì£¼ ì´ìš©í•˜ëŠ” ê²ƒì´ë‹¤.  
    ë˜í•œ ë¶ˆí•„ìš”í•œ ì „ìê¸°ê¸° í”ŒëŸ¬ê·¸ë¥¼ ë½‘ê³ , ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¬¼í’ˆì„ ìƒí™œ ì†ì—ì„œ ìŠµê´€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„ ì¤‘ìš”í•˜ë‹¤.  
    í•™êµë‚˜ ê°€ì •ì—ì„œëŠ” í•¨ê»˜ ì°¸ì—¬í•  ìˆ˜ ìˆëŠ” ì ˆì•½ ìº í˜ì¸ì„ ë§Œë“¤ì–´ ì‘ì€ ì„±ê³¼ë¥¼ ìŒ“ì•„ ë‚˜ê°€ì•¼ í•œë‹¤.  
    ê²°êµ­, ì²­ì†Œë…„ í•œ ëª…ì˜ ì‹¤ì²œì´ ëª¨ì´ë©´ í° ë³€í™”ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ê·¸ê²ƒì´ ë°”ë¡œ ìš°ë¦¬ì˜ ë¯¸ë˜ë¥¼ ì§€ì¼œë‚¼ ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì´ë‹¤.
    """)

    st.markdown("## ğŸŒ± ì—ë„ˆì§€ ì ˆì•½ ì‹¤ì²œ ì²´í¬ë¦¬ìŠ¤íŠ¸")
    col1, col2 = st.columns(2)
    with col1:
        c1 = st.checkbox("ì—ì–´ì»¨ ì˜¨ë„ 26ë„ ìœ ì§€í•˜ê¸°", key=f"{tab_name}_c1")
        c2 = st.checkbox("ì„ í’ê¸°ì™€ ë³‘í–‰ ì‚¬ìš©í•˜ê¸°", key=f"{tab_name}_c2")
        c3 = st.checkbox("ë¶ˆí•„ìš”í•œ ì¡°ëª… ë„ê¸°", key=f"{tab_name}_c3")
        c4 = st.checkbox("ëŒ€ì¤‘êµí†µ ì´ìš©í•˜ê¸°", key=f"{tab_name}_c4")
        c5 = st.checkbox("ë¶„ë¦¬ìˆ˜ê±° ì² ì €íˆ í•˜ê¸°", key=f"{tab_name}_c5")
    with col2:
        c6 = st.checkbox("ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì „ìê¸°ê¸° í”ŒëŸ¬ê·¸ ë½‘ê¸°", key=f"{tab_name}_c6")
        c7 = st.checkbox("ëƒ‰ë°© ì‹œ ë¬¸ ë‹«ì•„ íš¨ìœ¨ ë†’ì´ê¸°", key=f"{tab_name}_c7")
        c8 = st.checkbox("ê³„ë‹¨ ì´ìš©í•˜ê¸°", key=f"{tab_name}_c8")
        c9 = st.checkbox("ì¬ì‚¬ìš© ë¬¼í’ˆ í™œìš©í•˜ê¸°", key=f"{tab_name}_c9")
        c10 = st.checkbox("í…€ë¸”ëŸ¬ ì‚¬ìš©í•˜ê¸°", key=f"{tab_name}_c10")

    checked = sum([c1,c2,c3,c4,c5,c6,c7,c8,c9,c10])
    progress = checked / 10
    st.progress(progress)

    if progress == 1:
        st.success("ğŸ‰ ëª¨ë“  ì‹¤ì²œì„ ì™„ë£Œí–ˆì–´ìš”! ë©‹ì§‘ë‹ˆë‹¤, ì§€êµ¬ê°€ í™˜í•˜ê²Œ ì›ƒê³  ìˆì–´ìš”!")
    elif progress >= 0.8:
        st.info("ğŸŒŸ 80% ë‹¬ì„±! ê±°ì˜ ë‹¤ ì™”ì–´ìš”, ì¡°ê¸ˆë§Œ ë” í˜ë‚´ìš”!")
    elif progress >= 0.6:
        st.info("ğŸ’ª 60% ë‹¬ì„±! ì˜í•˜ê³  ìˆì–´ìš”, ê¾¸ì¤€í•¨ì´ ì¤‘ìš”í•´ìš”!")
    elif progress >= 0.4:
        st.info("âœ¨ 40% ë‹¬ì„±! ì‹œì‘ì´ ë°˜ì´ì—ìš”, ê³„ì† ì‹¤ì²œí•´ë´ìš”!")
    else:
        st.write("ì•„ì§ ì‹¤ì²œì´ ì ì§€ë§Œ, ì‘ì€ ì‹œì‘ì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤ ğŸŒ±")

# ----------------------------
# Tabs
# ----------------------------
tabs = st.tabs(["í•´ìˆ˜ë©´ ìƒìŠ¹ ì¶”ì´", "ì§€ì—­ë³„ ìœ„í—˜", "ì—ì–´ì»¨ ì‹œë®¬ë ˆì´ì…˜", "ìœ„í—˜ ì‹œê°í™”"])

# ----------------------------
# Tab1: í•´ìˆ˜ë©´ ìƒìŠ¹ ì¶”ì´
# ----------------------------
with tabs[0]:
    st.sidebar.header("Tab1 ì¡°ì‘")
    start_year, end_year = st.sidebar.slider(
        "ì—°ë„ ì„ íƒ", int(sea_df["year"].min()), int(sea_df["year"].max()), (1950, 2020)
    )
    filtered = sea_df[(sea_df["year"] >= start_year) & (sea_df["year"] <= end_year)]

    coef = np.polyfit(filtered["year"], filtered["sea_level"], 1)
    poly1d_fn = np.poly1d(coef)
    trendline = poly1d_fn(filtered["year"])

    fig = go.Figure()
    fig.add_trace(go.Scatter(x=filtered["year"], y=filtered["sea_level"],
                             mode="markers+lines", name="ì‹¤ì œ ë°ì´í„°", line=dict(color="blue")))
    fig.add_trace(go.Scatter(x=filtered["year"], y=trendline,
                             mode="lines", name="ì¶”ì„¸ì„  (ì˜ˆì¸¡)", line=dict(color="red", dash="dash")))

    fig.update_layout(title="ì „ì„¸ê³„ í•´ìˆ˜ë©´ ìƒìŠ¹ ì¶”ì´ (NOAA ê¸°ë°˜ ë°ì´í„°)",
                      xaxis_title="ì—°ë„", yaxis_title="ìƒëŒ€ í•´ìˆ˜ë©´ (mm)")

    st.plotly_chart(fig, use_container_width=True)

    st.markdown("""
    ### ğŸ“Š ë¶„ì„
    ë°ì´í„°ë¥¼ ë³´ë©´ í•´ìˆ˜ë©´ì€ ê¾¸ì¤€íˆ ìƒìŠ¹í•´ ì™”ìœ¼ë©°, ì¶”ì„¸ì„ ì€ ì•ìœ¼ë¡œë„ ì¦ê°€ì„¸ê°€ ì´ì–´ì§ˆ ê²ƒì„ì„ ë³´ì—¬ì¤€ë‹¤.  
    ì´ëŠ” ë‹¨ìˆœí•œ ì¼ì‹œì  ë³€ë™ì´ ì•„ë‹ˆë¼ **ì¥ê¸°ì Â·êµ¬ì¡°ì ì¸ ìƒìŠ¹**ì„ì„ ì˜ë¯¸í•œë‹¤.  
    ë”°ë¼ì„œ ì§€ê¸ˆ í–‰ë™í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ì•ìœ¼ë¡œì˜ ì„¸ëŒ€ëŠ” ë” í° í”¼í•´ë¥¼ ë§ì´í•  ìˆ˜ë°–ì— ì—†ë‹¤.
    """)

    report_and_checklist("tab1")

# ----------------------------
# Tab2: ì§€ì—­ë³„ ìœ„í—˜ (5ë‹¨ê³„ ìƒ‰ìƒ)
# ----------------------------
with tabs[1]:
    st.sidebar.header("Tab2 ì¡°ì‘")
    year = st.sidebar.slider("ì˜ˆìƒ ì—°ë„", 2020, 2100, 2050, step=10)

    city_base_risks = {
        "ì„œìš¸": {"coords": [37.5665, 126.9780], "risk": 25},
        "ë¶€ì‚°": {"coords": [35.1796, 129.0756], "risk": 70},
        "ë„ì¿„": {"coords": [35.6895, 139.6917], "risk": 55},
        "ìƒí•˜ì´": {"coords": [31.2304, 121.4737], "risk": 85},
        "ìì¹´ë¥´íƒ€": {"coords": [-6.2088, 106.8456], "risk": 95},
        "ëŸ°ë˜": {"coords": [51.5074, -0.1278], "risk": 35},
        "ì•”ìŠ¤í…Œë¥´ë‹´": {"coords": [52.3676, 4.9041], "risk": 80},
        "ë‰´ìš•": {"coords": [40.7128, -74.0060], "risk": 65},
        "ë§ˆì´ì• ë¯¸": {"coords": [25.7617, -80.1918], "risk": 90},
        "ë¦¬ìš°ë°ìë„¤ì´ë£¨": {"coords": [-22.9068, -43.1729], "risk": 45},
        "ì¼€ì´í”„íƒ€ìš´": {"coords": [-33.9249, 18.4241], "risk": 50},
        "ì‹œë“œë‹ˆ": {"coords": [-33.8688, 151.2093], "risk": 40}
    }

    factor = (year - 2020) / (2100 - 2020)
    city_data = {k: {"coords": v["coords"], "risk": min(100, int(v["risk"] * factor))} for k, v in city_base_risks.items()}

    def risk_to_color(risk):
        if risk <= 20: return "green"
        elif risk <= 40: return "lightgreen"
        elif risk <= 60: return "yellow"
        elif risk <= 80: return "orange"
        else: return "red"

    m = folium.Map(location=[20, 0], zoom_start=2)
    for city_name, info in city_data.items():
        folium.CircleMarker(
            location=info["coords"], radius=8,
            popup=f"{city_name} (ìœ„í—˜ë„: {info['risk']})",
            color=risk_to_color(info["risk"]), fill=True,
            fill_color=risk_to_color(info["risk"]), fill_opacity=0.8
        ).add_to(m)

    st.subheader(f"ì„¸ê³„ ì£¼ìš” ë„ì‹œ ìœ„í—˜ë„ ({year}ë…„ ê¸°ì¤€)")
    st_folium(m, width=700, height=500)

    st.markdown("""
    ### ğŸŒ ë¶„ì„
    ì—°ë„ë¥¼ ì¡°ì ˆí•˜ë©´ ìœ„í—˜ë„ê°€ ì ì  ë†’ì•„ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
    íŠ¹íˆ **í•´ì•ˆê°€ ë„ì‹œ(ìì¹´ë¥´íƒ€, ë§ˆì´ì• ë¯¸, ìƒí•˜ì´, ì•”ìŠ¤í…Œë¥´ë‹´ ë“±)**ëŠ” ë¹¨ê°„ìƒ‰ì— ê°€ê¹Œì›Œì§€ë©°,  
    ì´ëŠ” ì‹¤ì œë¡œë„ ì´ë¯¸ ì¹¨ìˆ˜ ìœ„í—˜ì´ ë³´ê³ ëœ ì§€ì—­ë“¤ì´ë‹¤.  
    ë°˜ë©´ ë‚´ë¥™ì— ìœ„ì¹˜í•œ ë„ì‹œ(ì„œìš¸, ëŸ°ë˜ ë“±)ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë‚®ì€ ìœ„í—˜ì„ ë³´ì¸ë‹¤.  
    ê·¸ëŸ¬ë‚˜ í•´ì•ˆ ê²½ì œì™€ ì—°ê²°ëœ ê¸€ë¡œë²Œ ë„ì‹œëŠ” **ì„¸ê³„ì  ì¶©ê²©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ” ìœ„í—˜ ìš”ì¸**ì´ ëœë‹¤.
    """)

    report_and_checklist("tab2")

# ----------------------------
# Tab3: ì—ì–´ì»¨ ì‹œë®¬ë ˆì´ì…˜
# ----------------------------
with tabs[2]:
    st.sidebar.header("Tab3 ì¡°ì‘")
    hours = st.sidebar.slider("í•˜ë£¨ ì‚¬ìš© ì‹œê°„ (ì‹œê°„)", 0, 24, 8)
    days = st.sidebar.slider("ì‚¬ìš© ì¼ìˆ˜", 0, 365, 120)

    co2_per_hour = 1.2
    energy_per_hour = 1.5
    total_co2 = hours * days * co2_per_hour
    total_energy = hours * days * energy_per_hour
    impact = total_co2 * 0.0000015

    st.subheader("ì—ì–´ì»¨ ì‚¬ìš© ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼")
    st.write(f"- ì´ COâ‚‚ ë°°ì¶œëŸ‰: **{total_co2:.1f} kg**")
    st.write(f"- ì´ ì „ë ¥ ì‚¬ìš©ëŸ‰: **{total_energy:.1f} kWh**")
    st.write(f"- ì˜ˆìƒ í•´ìˆ˜ë©´ ìƒìŠ¹ ê¸°ì—¬: **{impact:.3f} mm**")

    st.markdown(f"""
    ### ğŸ” ë¶„ì„
    ë‹¨ìˆœíˆ í•˜ë£¨ {hours}ì‹œê°„, {days}ì¼ ë™ì•ˆì˜ ì‚¬ìš©ë§Œìœ¼ë¡œë„ ìƒë‹¹í•œ ì–‘ì˜ COâ‚‚ê°€ ë°°ì¶œëœë‹¤.  
    ì´ëŠ” ê°œê°œì¸ì˜ ì‚¬ìš©ì´ ëª¨ì´ë©´ **êµ­ê°€ ë‹¨ìœ„ì˜ ì—„ì²­ë‚œ ë°°ì¶œëŸ‰**ìœ¼ë¡œ ì´ì–´ì§„ë‹¤ëŠ” ì ì„ ì‹œì‚¬í•œë‹¤.  
    ë”°ë¼ì„œ ëƒ‰ë°© ìŠµê´€ì„ ë°”ê¾¸ëŠ” ê²ƒì€ ê³§ë°”ë¡œ **íƒ„ì†Œ ê°ì¶• ì‹¤ì²œ**ìœ¼ë¡œ ì´ì–´ì§ˆ ìˆ˜ ìˆë‹¤.
    """)

    report_and_checklist("tab3")

# ----------------------------
# Tab4: ìœ„í—˜ ì‹œê°í™”
# ----------------------------
with tabs[3]:
    st.sidebar.header("Tab4 ì¡°ì‘")
    risk_value = st.sidebar.slider("ìœ„í—˜ ì§€ìˆ˜ (0=ì•ˆì „, 100=ìœ„í—˜)", 0, 100, 50)

    color = "green"
    if risk_value > 80: color = "red"
    elif risk_value > 60: color = "orange"
    elif risk_value > 40: color = "yellow"
    elif risk_value > 20: color = "lightgreen"

    fig = go.Figure(go.Indicator(
        mode="gauge+number", value=risk_value,
        title={"text": "í•´ìˆ˜ë©´ ìƒìŠ¹ ìœ„í—˜ ì§€í‘œ"},
        gauge={"axis": {"range": [0, 100]}, "bar": {"color": color}}
    ))
    st.plotly_chart(fig, use_container_width=True)

    st.markdown(f"""
    ### âš ï¸ ë¶„ì„
    ìœ„í—˜ ì§€ìˆ˜ë¥¼ {risk_value}ë¡œ ì„¤ì •í–ˆì„ ë•Œ, ì´ëŠ” ë‹¨ìˆœí•œ ìˆ˜ì¹˜ê°€ ì•„ë‹ˆë¼  
    **ì‚¬íšŒÂ·ê²½ì œÂ·í™˜ê²½ì  ìœ„í—˜ ìˆ˜ì¤€**ì„ ê°€ëŠ í•˜ëŠ” ì§€í‘œê°€ ë  ìˆ˜ ìˆë‹¤.  
    ì˜ˆë¥¼ ë“¤ì–´ 80 ì´ìƒì¼ ê²½ìš°, **ê¸°í›„ë‚œë¯¼ ë°œìƒÂ·ì£¼ê±°ì§€ ìƒì‹¤Â·ê²½ì œì  ì¶©ê²©** ë“±ì´ í˜„ì‹¤í™”ë  ìˆ˜ ìˆë‹¤.  
    ì´ ì§€í‘œëŠ” ê³§ë°”ë¡œ í–‰ë™ì˜ í•„ìš”ì„±ì„ ìƒê¸°ì‹œì¼œ ì¤€ë‹¤.
    """)

    report_and_checklist("tab4")
